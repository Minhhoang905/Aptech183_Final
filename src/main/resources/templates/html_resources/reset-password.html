<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reset Password</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <style>
        body {
            display: flex;
            flex-direction: column;
            background-image: url("/image_resources/img_home/1.JPG");
            object-fit: contain;
            background-repeat: no-repeat;
            color: white;
        }

        h3 {
            letter-spacing: 1px;
            font-size: 24px;
            text-shadow: -1px -1px 0 #00000079, 1px -1px 0 #00000057, -1px 1px 0 #00000053, 1px 1px 0 #0000005a;
        }

        .content {
            margin-top: 5vh;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }

        header {
            font-family: 'Impact', Courier, monospace;
            text-decoration: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            padding: 0px 3%;
            display: flex;
            align-items: center;
            justify-content: space-between;
            z-index: 1000;

        }

        header .logo {
            color: white;
            font-size: 30px;
            text-decoration: none;
            cursor: pointer;
        }

        header .logo span {
            color: rgb(11, 211, 85);
        }

        header .navbar ul {
            list-style: none;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        header .navbar ul li {
            position: relative;
            float: left;
        }

        header .navbar ul li a {
            display: block;
            padding: 20px;
            color: white;
            font-size: 20px;
            transition: ease-in 0.3s;
            cursor: pointer;
            text-decoration: none;
        }

        header .navbar ul li .fa-circle-user {
            font-size: 20px;
            padding-right: 10px;
        }

        nav ul li a:hover {
            color: rgb(11, 211, 85);
        }

        header .navbar ul li ul {
            position: absolute;
            left: 0;
            width: 200px;
            display: none;
        }

        header .navbar ul li ul li {
            width: 100%;
        }

        header .navbar ul li:hover>ul {
            display: initial;
        }

        header .navbar ul li .button {
            color: black;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            width: 120px;
            padding: 7px 7px;
            background-color: rgb(11, 211, 85);
            transition: ease-in-out 0.3s;
            cursor: pointer;
            margin-left: 20px;
        }

        header .navbar ul li .button:hover {
            color: white;
        }

        .content h2 {
            text-shadow: -1px -1px 0 #00000079, 1px -1px 0 #00000057, -1px 1px 0 #00000053, 1px 1px 0 #0000005a;
            color: white;
            font-size: 50px;
            color: rgb(11, 211, 85);
            margin-bottom: 10px;
            font-family: 'Impact', Haettenschweiler, sans-serif;

        }

        .content form div {
            border-radius: 8px;
            height: 40px;
            width: 500px;
            background-color: white;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .content form div input {
            outline: none;
            border: none;

        }

        .content form button {
            margin: 20px 10px;
            height: 40px;
            width: 200px;
            background-color: rgb(11, 211, 85);
            border: none;
            font-family: 'Impact', Haettenschweiler, sans-serif;
            font-size: 20px;
            color: aliceblue;
            cursor: pointer;

        }

        .content form {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-family: 'Impact', Haettenschweiler, sans-serif;
        }

        .error {
            color: red;
            font-size: 14px;
        }

        .success {
            color: green;
            font-size: 14px;
        }

        .input-container {
            position: relative;
            display: inline-block;
        }

        .toggle-password {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            cursor: pointer;
        }

        #popupContainer {
            display: none;
            position: fixed;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.3);
            z-index: 1000;
        }

        #popupContainer button {
            margin-top: 10px;
            padding: 5px 10px;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <header>
        <a th:href="@{/ComplexGym/home}" class="logo">Complex<span> Gym</span></a>
        <nav class="navbar">
            <ul>
                <li><a th:href="@{/ComplexGym/home}">BACK TO HOME</a></li>
        </nav>
    </header>
    <div class="content">
        <h2>Reset Password</h2>

        <!-- Hi·ªÉn th·ªã l·ªói t·ª´ back-end -->
        <p id="errorMessage" class="error" th:text="${errorMessage}" style="color:black;display: none;"></p>
        <p id="successMessage" class="success" th:text="${successMessage}" style="color:black;display: none;"></p>

        <!-- Form ƒë·∫∑t l·∫°i m·∫≠t kh·∫©u -->
        <form id="resetPasswordForm" th:action="@{/forgot-password/reset}" th:object="${changeNewPass}" method="post">
            <input type="hidden" name="token" th:value="${token}">

            <h3>Username</h3>
            <div class="input-container">
                <input size="67" type="text" id="name" name="name" placeholder="Enter username" required>
            </div>
            <p id="nameError" class="error"></p>

            <h3>New password</h3>
            <div class="input-container">
                <input size="67" type="password" id="pass" name="pass" placeholder="Enter new password" required>
                <span class="toggle-password" onclick="togglePassword('pass', this)">üôà</span>
            </div>
            <p id="passError" class="error"></p>

            <h3>Confirm password</h3>
            <div class="input-container">
                <input size="67" type="password" id="newPass" name="newPass" placeholder="Confirm new password"
                    required>
                <span class="toggle-password" onclick="togglePassword('newPass', this)">üôà</span>
            </div>
            <p id="newPassError" class="error"></p>

            <button type="submit">Reset Password</button>
        </form>


    </div>
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script>
        // H√†m chuy·ªÉn ƒë·ªïi hi·ªÉn th·ªã m·∫≠t kh·∫©u (·∫©n/hi·ªán)
        function togglePassword(inputId, toggleButton) {
            const passwordInput = document.getElementById(inputId);
            const isPasswordVisible = passwordInput.type === 'password';
            passwordInput.type = isPasswordVisible ? 'text' : 'password';
            toggleButton.textContent = isPasswordVisible ? 'üëÅÔ∏è' : 'üôà';
        }

        // H√†m hi·ªÉn th·ªã SweetAlert l·ªói
        function showError(message) {
            Swal.fire({
                icon: 'error',
                title: 'Oops...',
                html: message.replace(/\n/g, '<br>'),
                confirmButtonText: 'OK'
            });
        }

        // H√†m hi·ªÉn th·ªã SweetAlert th√†nh c√¥ng v·ªõi callback khi nh·∫•n OK
        function showSuccess(message, onConfirm) {
            Swal.fire({
                icon: 'success',
                title: 'Success',
                html: message.replace(/\n/g, '<br>'),
                confirmButtonText: 'OK'
            }).then((result) => {
                if (result.isConfirmed && onConfirm) {
                    onConfirm();
                }
            });
        }

        // H√†m hi·ªÉn th·ªã x√°c nh·∫≠n v·ªõi 2 n√∫t OK/Cancel
        function showConfirm(message, onConfirm) {
            Swal.fire({
                title: 'Are you sure?',
                html: message.replace(/\n/g, '<br>'),
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'Yes, reset it!',
                cancelButtonText: 'Cancel'
            }).then((result) => {
                if (result.isConfirmed && onConfirm) {
                    onConfirm();
                }
            });
        }

        $(document).ready(function () {
            // Ki·ªÉm tra n·∫øu c√≥ l·ªói t·ª´ back-end, hi·ªÉn th·ªã SweetAlert l·ªói
            let errorMessage = $('#errorMessage').text().trim();
            if (errorMessage) showError(errorMessage);

            // N·∫øu c√≥ th√¥ng b√°o th√†nh c√¥ng, hi·ªÉn th·ªã SweetAlert th√†nh c√¥ng r·ªìi chuy·ªÉn trang
            let successMessage = $('#successMessage').text().trim();
            if (successMessage) {
                showSuccess(successMessage, function () {
                    window.location.href = "/login"; // Chuy·ªÉn h∆∞·ªõng ƒë·∫øn trang ƒëƒÉng nh·∫≠p sau khi reset th√†nh c√¥ng
                });
            }

            // Ki·ªÉm tra form khi ng∆∞·ªùi d√πng nh·∫•n "Reset Password"
            $('#resetPasswordForm').on('submit', function (event) {
                let isValid = true;
                let username = $('input[name="name"]').val().trim();
                let newPass = $('input[name="pass"]').val().trim();
                let confirmPass = $('input[name="newPass"]').val().trim();
                let errors = [];

                // Ki·ªÉm tra Username
                if (username.length < 5) errors.push("Username must be at least 5 characters.");
                if (!/^[a-zA-Z0-9]+$/.test(username)) errors.push("Username must not contain special characters.");

                // Ki·ªÉm tra M·∫≠t kh·∫©u theo c√°c ti√™u ch√≠ b·∫£o m·∫≠t
                if (newPass.length < 8) errors.push("Password must be at least 8 characters.");
                if (!/[A-Z]/.test(newPass)) errors.push("Must contain at least 1 uppercase letter.");
                if (!/[a-z]/.test(newPass)) errors.push("Must contain at least 1 lowercase letter.");
                if (!/[0-9]/.test(newPass)) errors.push("Must contain at least 1 number.");
                if (!/[@$!%*?&]/.test(newPass)) errors.push("Must contain at least 1 special character (@$!%*?&).");
                if (/[Ôº°-Ôº∫ÔΩÅ-ÔΩöÔºê-Ôºô]/.test(newPass)) errors.push("Password must not contain full-size characters.");

                // N·∫øu c√≥ l·ªói nh·∫≠p li·ªáu, hi·ªÉn th·ªã SweetAlert l·ªói
                if (errors.length > 0) {
                    isValid = false;
                    event.preventDefault();
                    showError(errors.join('<br>'));
                    return;
                }

                // Ki·ªÉm tra confirm password
                if (newPass !== confirmPass) {
                    isValid = false;
                    event.preventDefault();
                    showError("Confirm password does not match.");
                    return;
                }

                // N·∫øu mu·ªën th√™m b∆∞·ªõc x√°c nh·∫≠n tr∆∞·ªõc khi g·ª≠i form (t√πy ch·ªçn)
                event.preventDefault();
                showConfirm("Are you sure you want to reset your password?", function () {
                    $('#resetPasswordForm')[0].submit();
                });
            });
        });
    </script>

</body>

</html>